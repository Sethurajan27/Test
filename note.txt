https://script.google.com/u/0/home/projects/create?parent=1UFb8AUUZyp5KYaFIxANlqja0qvO_MO80UJmSEolDSxk&pli=1







// Called by frontend every 10 seconds
function pollInboxFast() {
  const isRunning = PropertiesService.getScriptProperties().getProperty('running');
  if (isRunning !== 'true') return { status: 'Stopped' };

  const email = PropertiesService.getScriptProperties().getProperty('email');
  if (!email) return { status: 'No email' };

  const [login, domain] = email.split('@');
  const listUrl = `https://www.1secmail.com/api/v1/?action=getMessages&login=${login}&domain=${domain}`;
  const messages = JSON.parse(UrlFetchApp.fetch(listUrl).getContentText());

  const sheet = getInboxSheet();
  const existingIDs = sheet.getRange(2, 1, sheet.getLastRow(), 1).getValues().flat();
  let newCount = 0;

  messages.forEach(msg => {
    if (!existingIDs.includes(String(msg.id))) {
      const detailUrl = `https://www.1secmail.com/api/v1/?action=readMessage&login=${login}&domain=${domain}&id=${msg.id}`;
      const detail = JSON.parse(UrlFetchApp.fetch(detailUrl).getContentText());

      const content = detail.body || detail.textBody || '';
      const otpMatch = content.match(/\b\d{4,8}\b/);
      const otp = otpMatch ? otpMatch[0] : '';

      sheet.appendRow([
        msg.id,
        detail.date,
        detail.from,
        otp,
        content
      ]);

      newCount++;
    }
  });

  return {
    status: `Checked at ${new Date().toLocaleTimeString()}, ${newCount} new message(s)`,
    email: email
  };
}










<script>
  let intervalID = null;

  function log(msg) {
    const logDiv = document.getElementById('log');
    logDiv.textContent += '\n' + msg;
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function start() {
    log("Starting monitor...");
    google.script.run.withSuccessHandler(function(email) {
      document.getElementById('email').textContent = "Email: " + email;
      log("Monitoring started for: " + email);
      // Start polling every 10 seconds
      intervalID = setInterval(checkInbox, 10000); // 10,000 ms = 10 sec
    }).startMonitoring();
  }

  function stop() {
    google.script.run.stopMonitoring();
    document.getElementById('email').textContent = "Monitoring stopped.";
    log("Monitoring stopped by user.");
    clearInterval(intervalID);
  }

  function checkInbox() {
    google.script.run.withSuccessHandler(function(result) {
      if (result && result.status) {
        log(result.status);
        if (result.email) {
          document.getElementById('email').textContent = "Email: " + result.email;
        }
      }
    }).pollInboxFast();
  }
</script>
