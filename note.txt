from playwright.sync_api import sync_playwright

def automate_openai_signup():
    with sync_playwright() as p:
        browser = p.chromium.launch(headless=False)  # Set headless=True to run in background
        context = browser.new_context()
        page = context.new_page()

        # Step 1: Navigate to signup page
        page.goto("https://auth.openai.com/create-account")
        page.fill('input[type="email"]', 'user@example.com')
        page.click('button:has-text("Continue")')
        
        # Wait for password field
        page.wait_for_url("**/password")
        page.fill('input[type="password"]', 'Password1@chatgpt')
        page.click('button:has-text("Continue")')
        
        # Wait for email verification page
        page.wait_for_url("**/email-verification")
        print("Please enter the code manually from your email.")
        page.pause()  # Wait for manual OTP entry

        # Step: About You
        page.wait_for_url("**/about-you")
        name = 'user@example.com'.split('@')[0]
        name = ''.join(filter(lambda c: not c.isdigit(), name))
        page.fill('input[name="fullName"]', name)
        page.fill('input[name="dob"]', '11-11-1999')
        page.click('button:has-text("Continue")')

        # Step: Create Organization
        page.wait_for_url("**/welcome?step=create")
        page.fill('input[name="organizationName"]', 'Personal')
        page.click('button:has-text("Create organization")')

        # Step: Invite
        page.wait_for_url("**/welcome?step=invite")
        page.click("button:has-text(\"I'll invite my team later\")")
        #page.click('button:has-text("I'll invite my team later")')

        # Step: Try
        page.wait_for_url("**/welcome?step=try")
        page.click('button:has-text("Generate API key")')

        # Get API key
        page.wait_for_selector('[data-testid="api-key"]')
        api_key = page.inner_text('[data-testid="api-key"]')
        print("Generated API Key:", api_key)

        browser.close()

automate_openai_signup()
