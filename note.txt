https://script.google.com/u/0/home/projects/create?parent=1UFb8AUUZyp5KYaFIxANlqja0qvO_MO80UJmSEolDSxk&pli=1





// --- GLOBAL VARS ---
let running = true;
const emailDomain = '1secmail.com';
let generatedLogin = '';

function startMonitoring() {
  generatedLogin = Utilities.getUuid().split('-')[0]; // generate random email
  const email = `${generatedLogin}@${emailDomain}`;
  PropertiesService.getScriptProperties().setProperty('email', email);
  running = true;
  monitorInbox();
}

function stopMonitoring() {
  running = false;
}

function monitorInbox() {
  const email = PropertiesService.getScriptProperties().getProperty('email');
  if (!email || !running) return;

  const [login, domain] = email.split('@');
  const url = `https://www.1secmail.com/api/v1/?action=getMessages&login=${login}&domain=${domain}`;
  const response = UrlFetchApp.fetch(url);
  const messages = JSON.parse(response.getContentText());

  messages.forEach(msg => {
    const messageId = msg.id;
    const detailUrl = `https://www.1secmail.com/api/v1/?action=readMessage&login=${login}&domain=${domain}&id=${messageId}`;
    const detailRes = UrlFetchApp.fetch(detailUrl);
    const detail = JSON.parse(detailRes.getContentText());

    const content = detail.body || detail.textBody || '';
    const otpMatch = content.match(/\b\d{4,8}\b/); // find 4-8 digit OTP
    const otp = otpMatch ? otpMatch[0] : '';

    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Inbox');
    const existingIds = sheet.getRange(2, 1, sheet.getLastRow(), 1).getValues().flat();
    if (!existingIds.includes(String(messageId))) {
      sheet.appendRow([
        messageId,
        new Date(detail.date),
        detail.from,
        otp,
        content
      ]);
    }
  });

  if (running) {
    ScriptApp.newTrigger('monitorInbox')
      .timeBased()
      .after(30000) // every 30 seconds
      .create();
  }
}

function getEmailAddress() {
  return PropertiesService.getScriptProperties().getProperty('email');
}

function doGet() {
  return HtmlService.createHtmlOutputFromFile('Page')
    .setTitle('1SecMail Monitor')
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}






<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: sans-serif; padding: 20px; }
      button { padding: 10px 20px; margin-right: 10px; }
      #email { font-weight: bold; margin-top: 10px; }
    </style>
  </head>
  <body>
    <h2>ðŸ“¨ 1SecMail Monitor</h2>
    <button onclick="start()">Start</button>
    <button onclick="stop()">Stop</button>
    <div id="email"></div>

    <script>
      function start() {
        google.script.run
          .withSuccessHandler(() => {
            google.script.run.withSuccessHandler(email => {
              document.getElementById("email").innerHTML = `Monitoring email: <br><code>${email}</code>`;
            }).getEmailAddress();
          })
          .startMonitoring();
      }

      function stop() {
        google.script.run.stopMonitoring();
        document.getElementById("email").innerHTML = "Monitoring stopped.";
      }
    </script>
  </body>
</html>
